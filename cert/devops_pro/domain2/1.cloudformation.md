# Notes for CloudFormation (CFN)

## Parameters

Input for CFN Template
Prevent error happening in template by using types
Use !Ref to reference a paramter anywhere in the template

- Type
  - String
  - Number
  - CommaDelimitedList
  - List<Type>
  - AWS Parameter (to help catch invalid values - match against existings value in the AWS Account)
- Description
- Contraints
  - ConstraintsDescription (String)
  - Min/Max Length
  - Min/Max Value
  - Defaults
  - AllowedValues (array)
  - AllowedPattern (regexp)
  - NoEcho (Boolean) - for passing a secret

### Pseudo Parameters

AWS::AccountId
AWS::NotificationARNs
AWS::NoValue
AWS::Region
AWS::StackId
AWS::StackName

## Resources (Mandatory)

Prepresent different AWS Components that will be created and configured
Resources are declared and can reference each other.

> Resource Types Identifiers are of the form: AWS::aws-product-name::data-type-name

[All Resources](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-template-resource-type-ref.html)

## Mapping

Fixed Variables within CFN Template
They're very handy to differentiate between

- different environments: (dev | prod)
- regions (AWS Regions)
- AMI Types
- Availability Zones
- AWS Account

To access Mapping use: `Fn::FindInMap` (return a named value from a specific key)
Or `!FindInMap [ MapName, TopLevelKey, SecondLevelKey]`
Ex: `ImageId: !FindInMap [RegionMap, !Ref "AWS::Region", "64" ]`

```
Mappings:
  Mapping01:
    Key01:
      Name: Value01
    Key02:
      Name: Value02
```

> Can use mapping to define the package of product for Athena in Karros

- small: BE(m5.large), CQ(t3.small), RDS(db.t3.small)
- medium: BE(m5.large), CQ(t3.medium), RDS(db.t3.medium)
- large: BE(m5.large), CQ(t3.large), RDS(db.t3.medium)
- xlarge: BE(m5.xlarge), CQ(t3.xlarge), RDS(db.m5.large)

```
Mappings:
  Package:
    Small:
      "BE": "m5.large"
      "CQ": "t3.small"
      "DB": "db.t3.small"
      "WN": "t3.large" # WOSNOS Instance Type
      "Debezium": ""
      "GeoServer": ""
    Medium:
      "BE": "m5.large"
      "CQ": "t3.small"
      "DB": "db.t3.small"
      "WN": "t3.large" # WOSNOS Instance Type
      "Debezium": ""
      "GeoServer": ""
    Large:
      "BE": "m5.large"
      "CQ": "t3.small"
      "DB": "db.t3.small"
      "WN": "t3.large" # WOSNOS Instance Type
      "Debezium": ""
      "GeoServer": ""

```

## Parameters vs Mappings

Mappings are great when you know in advance all the values that can be taken and that they can be deduced from variables (region, environment, AWS Account, ...). They allow safer controll over template

Parameters used when we don't know in the advance what User wants to specify.
