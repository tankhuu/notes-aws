# Elastic BeanStalk

## Save Configuration

`eb config save dev-env --cfg initial-configuration`

## Deployment

- All at once: fastest, downtime -> suit for development environment
- Rolling: update a few instances at a time (bucket), and then move onto the next bucket once the first bucket is healthy -> application is running below capacity, version simultaneously, long deployment
- Rolling with additional batches: like rolling, but spins up new instances to move the batch (so that the old application is still available) -> app running in capacity, versions simultaneously, longer deployment, good for prod environment.
- Immutable: spins up new instances in a new ASG, deploys version to these instances, and then swaps all the instances when everything is healthy -> zero downtime, high cost, double capacity, quick rollback, great for prod environment.

## Blue/Green Deployment


## Save configuration

This feature will help to create a configuration for EB in a file `prod.cfg.yml`, we can store this file in Git or somewhere and apply it in any where that we want.
Let's say that we wan to deploy the same EB environments in another region, then all we need to do is just go to EB in that region, load this configuration file and create the new env from there.

Configuration files will be store under folder `.elasticbeanstalk/.saved_configs`

### Commands

`eb config save dev-env --cfg initial-configuration` # Generate initial-configuration.cfg.yml file

`eb setenv ENABLE_COOL_NEW_FEATURE=true` # Add environment variables into config

`eb config put prod` # Update/Add new configuration in EB

## [EB Extensions](https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/ebextensions-optionsettings.html)

All files will be stored under folder `.ebextensions`

```
option_settings:
- namespace: namespace
  option_name: option name
  value: option value
```

### option_settings

aws:autoscaling:asg:
  max:
  min:
  desired:
aws:autoscaling:launchconfiguration:
  InstanceType: 

### .ebextensions for Resources

Using Resources block
- Add DynamoDB
- Add RDS

```
Resources:
  DynamoDBTable:
    Type: AWS::DynamoDB::Table
    Properties:
      ...
  NotificationTopic:
    Type: AWS::SNS::Topic

Outputs:
  NotificationTopicArn:
    Description:
    Value:

option_settings:
  aws:elasticbeanstalk:application:environment:
    # these are assigned dynamically during a deployment
    NOTIFICATION_TOPIC: '`{"Ref": "NotificationTopic"}`'
    DYNAMODB_TABLE: '`{"Ref": "DynamoDBTable"}`'
    AWS_REGION: '`{"Ref": "AWS::Region"}`'
```

Then run `eb deploy` to apply new changes

For getting the environment variables
```
# SSH into the instance and run
/opt/elasticbeanstalk/bin/get-config environment | jq
/opt/elasticbeanstalk/bin/get-config environment -k NOTIFICATION_TOPIC
/opt/elasticbeanstalk/bin/get-config environment -k DYNAMODB_TABLE
/opt/elasticbeanstalk/bin/get-config optionsettings
```

## Precedence

- Settings applied directly to the environment
- Saved Configurations
- Configuration Files (.ebextensions)
- Default Values

## RDS In or Out of Environment

## References

[EB CLI - Create, Manage and Share Environment Configuration] (https://aws.amazon.com/blogs/devops/using-the-elastic-beanstalk-eb-cli-to-create-manage-and-share-environment-configuration/)